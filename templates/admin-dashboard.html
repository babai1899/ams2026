<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMS Admin Portal | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; }
        /* Collapsed sidebar */
        .sidebar-collapsed {
            width: 72px !important;
        }

        /* Hide text when collapsed */
        .sidebar-collapsed .label,
        .sidebar-collapsed .brand-text {
            display: none;
        }

        /* Center icons */
        .sidebar-collapsed .sidebar-link {
            justify-content: center;
        }

        /* Slightly bigger icons for clarity */
        .sidebar-collapsed .icon {
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            #sidebar {
                position: none;
                height: 100vh;
                z-index: 50;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex h-screen overflow-hidden">

    <aside id="sidebar" class="relative w-64 transition-all duration-300 bg-blue-900 text-white">

        <button id="sidebarToggle"
        class="absolute top-4 right-[-12px] bg-blue-900 w-6 h-6 rounded-full flex items-center justify-center shadow-lg">
        ‚óÄ
        </button>

        <div class="p-6 text-2xl font-bold border-b border-blue-800 sidebar-brand">
            <span class="brand-text">
                AMS
                <span class="text-blue-400 text-sm block">ADMIN PANEL</span>
            </span>
        </div>
        
        <nav class="flex-1 p-4 space-y-2">
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 hover:bg-blue-800 rounded-lg transition">
                <span class="icon">üìä</span> <span class="label">Dashboard</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 hover:bg-blue-800 rounded-lg transition">
                <span class="icon">üìÑ</span> <span class="label">Applications</span>
            </a>
            <a href="#" onclick="openJobModal()" class="sidebar-link flex items-center space-x-3 p-3 hover:bg-blue-800 rounded-lg transition">
                <span class="icon">üíº</span> <span class="label">Job Postings</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 hover:bg-blue-800 rounded-lg transition">
                <span class="icon">‚úâÔ∏è</span> <span class="label">Inquiries</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 hover:bg-blue-800 rounded-lg transition">
                <span class="icon">‚öôÔ∏è</span> <span class="label">Site Settings</span>
            </a>
        </nav>
        <div class="p-4 border-t border-blue-800">
            <a href="/" class="flex items-center space-x-3 p-3 text-blue-300 hover:text-white transition">
                <span class="icon">‚Üê</span> <span class="label">View Website</span>
            </a>
        </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-y-auto">
        
        <header class="bg-white shadow-sm py-4 px-8 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800">Overview</h1>
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-500">Welcome, Super Admin</span>
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">A</div>
            </div>
        </header>

        <div class="p-8 space-y-8">
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-sm">New Applications</p>
                    <h3 class="text-3xl font-bold text-blue-600">124</h3>
                    <p class="text-xs text-green-500 mt-2">‚Üë 12% from last week</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-sm">Active Job Openings</p>
                    <h3 class="text-3xl font-bold text-gray-800">18</h3>
                    <p class="text-xs text-gray-400 mt-2">4 expiring soon</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-sm">Client Inquiries</p>
                    <h3 class="text-3xl font-bold text-orange-500">09</h3>
                    <p class="text-xs text-blue-500 mt-2">Requires attention</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <p class="text-gray-500 text-sm">Resume Downloads</p>
                    <h3 class="text-3xl font-bold text-gray-800">856</h3>
                    <p class="text-xs text-gray-400 mt-2">Total across all roles</p>
                </div>
            </div>

            <div class="p-8 space-y-8">
    
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-50 flex justify-between items-center bg-white sticky top-0">
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Active Job Postings</h3>
                            <p class="text-sm text-gray-500">Manage current listings on the live website</p>
                        </div>
                        <button onclick="openJobModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center gap-2">
                            <span>+</span> Post New Job
                        </button>
                    </div>
            
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50 text-gray-400 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-4">Job Title & ID</th>
                                    <th class="px-6 py-4">Department</th>
                                    <th class="px-6 py-4">Location</th>
                                    <th class="px-6 py-4">Status</th>
                                    <th class="px-6 py-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="jobTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="jobModal" class="fixed inset-0 z-[100] hidden bg-black/50 backdrop-blur-sm flex items-center justify-center p-4">
                <div class="bg-white rounded-3xl max-w-md w-full p-8 shadow-2xl">
                    <h3 id="modalTitle" class="text-xl font-bold mb-6 text-gray-900">Add New Job</h3>
                    <form id="jobForm" onsubmit="saveJob(event)" class="space-y-4">
                        <input type="hidden" id="editJobId">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Job Title</label>
                            <input type="text" id="jobTitle" required class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold mb-1">Dept. Code</label>
                                <input type="text" id="jobDept" placeholder="e.g. MED" required class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-1">Location</label>
                                <input type="text" id="jobLoc" required class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-1">Work-Time</label>
                                <select id="jobWorktime" required class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="Full Time">Full Time</option>
                                <option value="Part Time">Part Time</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-1">Upload Demand Draft</label>
                                <input type="file" accept=".pdf,.jpg,.jpeg,.doc,.docx" id="jobDemanddraft" required class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="button" onclick="closeJobModal()" class="flex-1 py-3 border border-gray-200 rounded-xl hover:bg-gray-50 transition">Cancel</button>
                            <button type="submit" class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-50 flex justify-between items-center">
                        <h3 class="font-bold text-gray-800">Recent Job Applications</h3>
                        <button class="text-blue-600 text-sm font-semibold hover:underline">View All</button>
                    </div>
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 text-gray-400 text-xs uppercase">
                            <tr>
                                <th class="px-6 py-3">Candidate</th>
                                <th class="px-6 py-3">Role</th>
                                <th class="px-6 py-3">Date</th>
                                <th class="px-6 py-3">Action</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr class="hover:bg-gray-50 transition">
                                <td class="px-6 py-4">
                                    <div class="font-semibold">Rahul Sharma</div>
                                    <div class="text-xs text-gray-400">rahul@example.com</div>
                                </td>
                                <td class="px-6 py-4"><span class="px-2 py-1 bg-blue-50 text-blue-600 rounded text-xs">Senior Staff Nurse</span></td>
                                <td class="px-6 py-4 text-sm">2 hours ago</td>
                                <td class="px-6 py-4"><button class="text-gray-400 hover:text-blue-600">üëÅÔ∏è Review</button></td>
                            </tr>
                            <tr class="hover:bg-gray-50 transition">
                                <td class="px-6 py-4">
                                    <div class="font-semibold">Priya Verma</div>
                                    <div class="text-xs text-gray-400">priya.v@example.com</div>
                                </td>
                                <td class="px-6 py-4"><span class="px-2 py-1 bg-green-50 text-green-600 rounded text-xs">Site Engineer</span></td>
                                <td class="px-6 py-4 text-sm">5 hours ago</td>
                                <td class="px-6 py-4"><button class="text-gray-400 hover:text-blue-600">üëÅÔ∏è Review</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4">Quick Actions</h3>
                        <div class="grid grid-cols-1 gap-3">
                            <button onclick="openJobModal()" class="w-full py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition">+ Post New Job</button>
                            <button onclick="openNotificationManager()"
                                class="w-full py-3 bg-white border border-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-100 transition">
                                Open Notification Management
                            </button>
                        </div>
                    </div>

                    <div id="serverStatusCard"
                    class="bg-gradient-to-br from-blue-900 to-blue-800 p-6 rounded-2xl text-white shadow-lg">
               
                   <h3 class="font-bold mb-4 text-lg">Web Server Status</h3>
               
                   <!-- Server -->
                   <div class="flex items-center justify-between text-sm mb-3">
                       <div class="flex items-center gap-2">
                           <span class="w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse"></span>
                           <span>Server</span>
                       </div>
                       <span class="font-semibold text-green-300">Online</span>
                   </div>
               
                   <!-- SSL -->
                    <div id="sslStatusRow" class="flex items-center justify-between text-sm mb-3">
                        <div class="flex items-center gap-2">
                            <span id="sslDot" class="w-2.5 h-2.5 rounded-full"></span>
                            <span>SSL Certificate</span>
                        </div>
                        <span id="sslText" class="font-semibold"></span>
                    </div>
               
                   <!-- Backup -->
                   <div class="flex items-center justify-between text-sm">
                       <div class="flex items-center gap-2">
                           <span class="w-2.5 h-2.5 rounded-full bg-blue-400"></span>
                           <span>Last Backup</span>
                       </div>
                       <span class="text-blue-200">Today, 04:00 AM</span>
                   </div>
               
                   <div class="mt-4 pt-3 border-t border-blue-700 text-xs text-blue-300">
                       Auto-monitoring enabled
                   </div>
               </div>
               
                </div>
            </div>

        </div>

        <div id="notificationSection"
            class="bg-white p-6 mx-4 md:mx-6 lg:mx-8 rounded-2xl shadow-sm border border-gray-100 scroll-mt-24">
            <h3 class="text-lg font-bold mb-3">Edit Notification Marquee</h3>
        
            <textarea id="marqueeInput"
                rows="3"
                maxlength="180"
                oninput="updateMarqueeCounter()"
                class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500"
                placeholder="Example: üöÄ NEW OPENINGS: Senior Nurses for Mumbai ‚Ä¢ IT PMs for Bangalore">
            </textarea>

            <div class="mt-1 text-right text-xs">
                <span id="marqueeCount" class="text-gray-500">0</span>
                / 180 characters
            </div>            
        
            <button onclick="saveMarquee()"
                class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-xl font-semibold hover:bg-blue-700 transition">
                Save Marquee Text
            </button>
        </div>
        
    </main>

    <script>
        //Protect Dashboard
        if(!sessionStorage.getItem('ams_admin')){
            window.location.href = "/";
        }
        // Sidebar Toggle
        const sidebar = document.getElementById('sidebar');
        const toggle = document.getElementById('sidebarToggle');
        let collapsed = false;

        toggle.onclick = () => {
            collapsed = !collapsed;

            sidebar.classList.toggle('sidebar-collapsed', collapsed);
            toggle.innerText = collapsed ? '‚ñ∂' : '‚óÄ';
        };

        function handleResponsiveSidebar() {
            if (window.innerWidth <= 768) {
                collapsed = true;
                sidebar.classList.add('sidebar-collapsed');
                toggle.innerText = '‚ñ∂';
            } else {
                collapsed = false;
                sidebar.classList.remove('sidebar-collapsed');
                toggle.innerText = '‚óÄ';
            }
        }

        // Run on load
        window.addEventListener('DOMContentLoaded', handleResponsiveSidebar);

        // Run on resize
        window.addEventListener('resize', handleResponsiveSidebar);

        // Initial Mock Data
        let jobs = JSON.parse(localStorage.getItem('ams_jobs')) || [];

        // Render Table
        function renderJobs() {
            const tbody = document.getElementById('jobTableBody');

            tbody.innerHTML = jobs.map(job => `
                <tr class="hover:bg-gray-50 transition border-b border-gray-50">
                    <td class="px-6 py-4">
                        <div class="font-bold text-gray-900">${job.title}</div>
                        <div class="text-xs text-gray-400 font-mono">ID: #AMS-0${job.id}</div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="text-xs font-semibold px-2 py-1 bg-gray-100 text-gray-600 rounded">${job.dept}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">${job.loc}</td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            ${job.status || "Active"}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <div class="flex justify-end gap-3">
                            <button onclick="editJob(${job.id})" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Edit</button>
                            <button onclick="deleteJob(${job.id})" class="text-red-500 hover:text-red-700 text-sm font-medium">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Delete Logic
        function deleteJob(id) {
            if(confirm('Are you sure you want to delete this job listing? It will be removed from the public website.')) {
                jobs = jobs.filter(j => j.id !== id);
                renderJobs();
            }
        }

        // Modal Controls
        function openJobModal() {
            document.getElementById('modalTitle').innerText = "Post New Job";
            document.getElementById('jobForm').reset();
            document.getElementById('editJobId').value = "";
            document.getElementById('jobModal').classList.remove('hidden');
        }

        function closeJobModal() {
            document.getElementById('jobModal').classList.add('hidden');
        }

        // Edit Logic (Fill modal with data)
        function editJob(id) {
            const job = jobs.find(j => j.id === id);
            document.getElementById('modalTitle').innerText = "Edit Job Listing";
            document.getElementById('editJobId').value = job.id;
            document.getElementById('jobTitle').value = job.title;
            document.getElementById('jobDept').value = job.dept;
            document.getElementById('jobLoc').value = job.loc;
            document.getElementById('jobWorktime').value = job.worktime;
            document.getElementById('jobDemanddraft').value = "";
            document.getElementById('jobModal').classList.remove('hidden');
        }

        // Save (Create or Update)
        function saveJob(e) {
            e.preventDefault();

            const id = document.getElementById('editJobId').value;
            const title = document.getElementById('jobTitle').value;
            const dept = document.getElementById('jobDept').value;
            const loc = document.getElementById('jobLoc').value;
            const worktime = document.getElementById('jobWorktime').value;

            const fileInput = document.getElementById('jobDemanddraft');
            const demandFile = fileInput.files[0];

            if (demandFile) {
                const reader = new FileReader();

                reader.onload = function (event) {
                    saveJobData(event.target.result);
                };

                reader.readAsDataURL(demandFile);
            } else {
                saveJobData(null);
            }

            function saveJobData(demandURL) {

                if (id) {
                    const index = jobs.findIndex(j => j.id == id);
                    jobs[index] = {
                        ...jobs[index],
                        title,
                        dept,
                        loc,
                        worktime,
                        demand: demandURL || jobs[index].demand
                    };
                } else {
                    const newId = jobs.length
                        ? Math.max(...jobs.map(j => j.id)) + 1
                        : 1;

                    jobs.push({
                        id: newId,
                        title,
                        dept,
                        loc,
                        worktime,
                        demand: demandURL,
                        status: "Active"
                    });
                }

                localStorage.setItem('ams_jobs', JSON.stringify(jobs));
                renderJobs();
                closeJobModal();
            }
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', renderJobs);

        // Notification Management
        function openNotificationManager() {
            const section = document.getElementById('notificationSection');
            const textarea = document.getElementById('marqueeInput');

            section.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // highlight effect
            section.classList.add('ring-2', 'ring-blue-400');

            setTimeout(() => {
                section.classList.remove('ring-2', 'ring-blue-400');
            }, 1200);

            // focus cursor
            setTimeout(() => {
                textarea.focus();
            }, 400);
        }
        function saveMarquee() {
            const text = document.getElementById('marqueeInput').value.trim();
            if (!text) {
                alert("Marquee text cannot be empty");
                return;
            }
            localStorage.setItem('ams_marquee_text', text);
            alert("Marquee updated successfully!");
        }

        // preload text
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('ams_marquee_text');
            if (saved) document.getElementById('marqueeInput').value = saved;
        });

        function updateMarqueeCounter() {
            const input = document.getElementById('marqueeInput');
            const counter = document.getElementById('marqueeCount');
            const max = input.maxLength;
            const length = input.value.length;

            counter.innerText = length;

            if (length >= max) {
                counter.classList.remove('text-gray-500');
                counter.classList.add('text-red-500', 'font-semibold');
            } else {
                counter.classList.remove('text-red-500', 'font-semibold');
                counter.classList.add('text-gray-500');
            }
        }

        // Load saved text + counter
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('ams_marquee_text');
            if (saved) {
                marqueeInput.value = saved;
                updateMarqueeCounter();
            }
        });

        // Web Server Status
        function updateServerStatus() {
            const online = true; // later from backend
            const sslActive = true;

            const card = document.getElementById('serverStatusCard');

            if (!online) {
                card.classList.replace('from-blue-900', 'from-red-900');
                card.classList.replace('to-blue-800', 'to-red-800');
            }
        }

        document.addEventListener('DOMContentLoaded', updateServerStatus);

        function updateSSLStatus() {

            // üîê SSL issued date (CHANGE THIS when renewed)
            const sslIssuedDate = new Date("2024-02-01"); // YYYY-MM-DD
            const SSL_VALIDITY_DAYS = 365;

            const today = new Date();
            const diffTime = today - sslIssuedDate;
            const daysUsed = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const daysLeft = SSL_VALIDITY_DAYS - daysUsed;

            const dot = document.getElementById("sslDot");
            const text = document.getElementById("sslText");
            const card = document.getElementById("serverStatusCard");

            // RESET colors
            card.className =
                "bg-gradient-to-br p-6 rounded-2xl text-white shadow-lg";

            if (daysLeft > 7) {
                // üü¢ ACTIVE
                dot.className = "w-2.5 h-2.5 rounded-full bg-green-400";
                text.className = "font-semibold text-green-300";
                text.innerText = `Active`; // `Active (${daysLeft} days left)`

                card.classList.add("from-blue-900", "to-blue-800");
            }

            else if (daysLeft > 0 && daysLeft <= 7) {
                // üü° EXPIRING SOON
                dot.className = "w-2.5 h-2.5 rounded-full bg-yellow-400 animate-pulse";
                text.className = "font-semibold text-yellow-300";
                text.innerText = `Expiring Soon (${daysLeft} days left)`;

                card.classList.add("from-yellow-900", "to-yellow-800");
            }

            else {
                // üî¥ CRITICAL (expired)
                dot.className = "w-2.5 h-2.5 rounded-full bg-red-500 animate-pulse";
                text.className = "font-semibold text-red-300";
                text.innerText = `Expired (${Math.abs(daysLeft)} days ago)`;

                card.classList.add("from-red-900", "to-red-800");
            }
            }

            document.addEventListener("DOMContentLoaded", updateSSLStatus);

            // -------- Last Backup code here --------

    </script>
</body>
</html>


